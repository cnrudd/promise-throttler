export default class PromiseThrottler{constructor(options){this.requestsPerSecond=options.requestsPerSecond;this.promiseImplementation=options.promiseImplementation||Promise;this.delay=Math.floor(1e3/this.requestsPerSecond);this.delayId=null;this.executing=false;this.queued=[]}add(promise){return new this.promiseImplementation((resolve,reject)=>{this.queued.push({resolve:resolve,reject:reject,promise:promise});if(!this.delayId&&!this.executing){this.dequeue()}})}addAll(promises){const addedPromises=promises.map(promise=>this.add(promise));return Promise.all(addedPromises)}dequeue(){if(this.queued.length===0){this.delayId=null;return}this._execute()}_execute(){const candidate=this.queued.shift();this.executing=true;candidate.promise().then(r=>{candidate.resolve(r)}).catch(r=>{candidate.reject(r)}).finally(()=>{this._setupNextDequeue()})}_setupNextDequeue(){this.executing=false;this.delayId=setTimeout(()=>this.dequeue(),this.delay)}}